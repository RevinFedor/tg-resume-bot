# –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

> **–í–ê–ñ–ù–û:** –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä—É—é –ù–ï–õ–¨–ó–Ø –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞.
> –ß–∏—Ç–∞–π —ç—Ç–æ—Ç —Ñ–∞–π–ª –ü–ï–†–í–´–ú –ø–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π —Å –ø—Ä–æ–µ–∫—Ç–æ–º.

---

## –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –∏–∑ –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤.

**Telegram –±–æ—Ç:** @chanresume_bot
**GitHub:** https://github.com/RevinFedor/tg-resume-bot
**Railway Dashboard:** https://railway.com/project/2edfccab-0f63-41ad-bc3b-e870b14b7fc9

---

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–ù–ê–ù–ò–Ø (–Ω–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–∑ –∫–æ–¥–∞)

### 1. –ü—Ä–æ–±–ª–µ–º–∞ last_post_id

**–ß—Ç–æ —ç—Ç–æ:** `last_post_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `channels` ‚Äî ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –ø–æ—Å—Ç–∞. Scheduler –±–µ—Ä—ë—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å—Ç—ã —Å `ID > last_post_id`.

**–õ–û–í–£–®–ö–ê:** Telegram message ID –≤ –∫–∞–Ω–∞–ª–µ ‚Äî —ç—Ç–æ –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä (1, 2, 3...). –£ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∫–∞–Ω–∞–ª–æ–≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç –∏–º–µ–µ—Ç ID 100-5000. –ï—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å `last_post_id=999999`, –±–æ—Ç –ù–ò–ö–û–ì–î–ê –Ω–µ —É–≤–∏–¥–∏—Ç –ø–æ—Å—Ç—ã!

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞–Ω–∞–ª–∞ ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å—Ç–∞ —á–µ—Ä–µ–∑ `parser.get_posts()`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `last_post_id` = —ç—Ç–æ—Ç ID
- –¢–æ–≥–¥–∞ –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ù–û–í–´–ï –ø–æ—Å—Ç—ã

**–ï—Å–ª–∏ –±–æ—Ç –Ω–µ –≤–∏–¥–∏—Ç –ø–æ—Å—Ç—ã:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å last_post_id
SELECT username, last_post_id FROM channels;

-- –°–±—Ä–æ—Å–∏—Ç—å –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ (–ø–æ—Å—Ç–∞–≤–∏—Ç—å 0 = –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –ø–æ—Å—Ç–æ–≤)
UPDATE channels SET last_post_id = 0 WHERE username = 'channel_name';
```

### 2. Gemini API Rate Limits

**–ö–†–ò–¢–ò–ß–ù–û:** –†–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–º–µ—é—Ç –†–ê–ó–ù–´–ï –ª–∏–º–∏—Ç—ã!

| –ú–æ–¥–µ–ª—å | RPD (–∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å) | RPM (–∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω) |
|--------|---------------------|-------------------|
| `gemini-2.0-flash` | 20 | 2 |
| `gemini-1.5-flash` | 1500 | 15 |
| `gemma-3-27b-it` | **14,400** | 30 |

**–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `gemma-3-27b-it`** –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–µ—ë —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –ª–∏–º–∏—Ç.

**–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –æ—à–∏–±–∫—É 429 –∏–ª–∏ "quota exceeded":**
1. –ü—Ä–æ–≤–µ—Ä—å –∫–∞–∫–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `summarizer.py`
2. Gemma 3 27B ‚Äî –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–∞—è, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
3. –ú–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ —Å—Ç–æ–∏—Ç –∑–∞–¥–µ—Ä–∂–∫–∞ 5 —Å–µ–∫ (`asyncio.sleep(5)`)

### 3. –ü—É—Å—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç Gemma (Output: 0)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç (–≤ –ª–æ–≥–∞—Ö: `Output: 0 tokens`).

**–ü—Ä–∏—á–∏–Ω—ã:**
- Safety filters –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç
- –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π/–Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º

**–†–µ—à–µ–Ω–∏–µ –≤ –∫–æ–¥–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `response.text`, retry, fallback –Ω–∞ "–ö–æ–Ω—Ç–µ–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω".

### 4. Scheduler –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª—ã –° –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

**–í–ê–ñ–ù–û:** Scheduler –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∫–∞–Ω–∞–ª—ã –≤ –ë–î ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞.

```python
.where(Channel.subscriptions.any())  # –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ!
```

–ï—Å–ª–∏ –∫–∞–Ω–∞–ª –µ—Å—Ç—å –≤ –ë–î, –Ω–æ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫ ‚Äî –æ–Ω –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.

### 5. Userbot —Å–µ—Å—Å–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î

–¢–∞–±–ª–∏—Ü–∞ `userbot_sessions` —Ö—Ä–∞–Ω–∏—Ç:
- `session_string` ‚Äî –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è Pyrogram
- `phone_number` ‚Äî –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `is_authorized` ‚Äî —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ü—Ä–∏ –ø–µ—Ä–µ–µ–∑–¥–µ –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä:**
- –°–µ—Å—Å–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏–∑ –ë–î
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ù–ï –Ω—É–∂–Ω–∞
- –ù–û: –µ—Å–ª–∏ —Å–µ—Å—Å–∏—è –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è Telegram ‚Äî –Ω—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ

### 6. Deprecation Warning google.generativeai

–í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:
```
FutureWarning: All support for the `google.generativeai` package has ended.
Please switch to the `google.genai` package.
```

**–°—Ç–∞—Ç—É—Å:** –ü–æ–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω—É–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ `google.genai` –≤ –±—É–¥—É—â–µ–º.

---

## –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ |
| `/help` | –°–ø—Ä–∞–≤–∫–∞ |
| `/channels` | –°–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫ |
| `/add @ch1 @ch2` | –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ |
| `/remove @channel` | –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –∫–∞–Ω–∞–ª–∞ |
| `/remove all` | –£–¥–∞–ª–∏—Ç—å –í–°–ï –ø–æ–¥–ø–∏—Å–∫–∏ |
| `/interests` | –ó–∞–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã –¥–ª—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å—Ç–æ–≤ üî• |
| `/interests clear` | –û—á–∏—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã |
| `/refresh` | –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ |
| `/stats` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| *–ü–µ—Ä–µ—Å–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ* | –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª |

### –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã –∫–æ–º–∞–Ω–¥–æ–π `/interests –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã, AI, —Å—Ç–∞—Ä—Ç–∞–ø—ã`.
–ü–æ—Å—Ç—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º, –±—É–¥—É—Ç –æ—Ç–º–µ—á–µ–Ω—ã –≤–∏–∑—É–∞–ª—å–Ω—ã–º –º–∞—Ä–∫–µ—Ä–æ–º:
```
üî•üî•üî• –ü–û –¢–í–û–ò–ú –ò–ù–¢–ï–†–ï–°–ê–ú üî•üî•üî•

[—Ä–µ–∑—é–º–µ –ø–æ—Å—Ç–∞]
```
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –≤–∞–∂–Ω—ã–µ –ø–æ—Å—Ç—ã –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tg-resume-bot/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # FastAPI + Webhook + Scheduler –∑–∞–ø—É—Å–∫
‚îÇ   ‚îú‚îÄ‚îÄ bot/handlers.py      # –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scheduler.py     # –§–æ–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (get_scheduler/set_scheduler)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ summarizer.py    # Gemma API (summarize, summarize_multimodal, describe_image)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ userbot.py       # Pyrogram MTProto (get_userbot_service)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transcription.py # Whisper API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ parser.py        # –í–µ–±-–ø–∞—Ä—Å–∏–Ω–≥ t.me/s/
‚îÇ   ‚îú‚îÄ‚îÄ api/routes.py        # REST API –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ db/
‚îÇ       ‚îú‚îÄ‚îÄ models.py        # User, Channel, Subscription, Post, UserbotSession
‚îÇ       ‚îî‚îÄ‚îÄ database.py      # SQLAlchemy async
‚îú‚îÄ‚îÄ admin/                    # React –∞–¥–º–∏–Ω–∫–∞ (–æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π)
‚îî‚îÄ‚îÄ CONTEXT.md               # –≠–¢–û –¢–´ –ß–ò–¢–ê–ï–®–¨
```

---

## Railway: –î–µ–ø–ª–æ–π

### –î–≤–∞ —Å–µ—Ä–≤–∏—Å–∞

| –°–µ—Ä–≤–∏—Å | Root Directory | –ö–æ–º–∞–Ω–¥–∞ –¥–µ–ø–ª–æ—è |
|--------|----------------|----------------|
| `resume-bot` | `/` | `railway up` |
| `admin-web` | `/admin` | `cd admin && railway up` |

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (resume-bot)

```bash
BOT_TOKEN=...              # –û—Ç @BotFather
GEMINI_API_KEY=...         # –û—Ç Google AI Studio
OPENAI_API_KEY=...         # –î–ª—è Whisper
DATABASE_URL=...           # PostgreSQL (Railway –¥–∞—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
WEBHOOK_URL=https://resume-bot-production.up.railway.app
TELEGRAM_API_ID=...        # –û—Ç my.telegram.org (–¥–ª—è Userbot)
TELEGRAM_API_HASH=...      # –û—Ç my.telegram.org (–¥–ª—è Userbot)
CHECK_INTERVAL_SECONDS=30  # –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–Ω–∞–ª–æ–≤
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (admin-web)

```bash
VITE_API_URL=https://resume-bot-production.up.railway.app
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `users` | Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ |
| `channels` | –ö–∞–Ω–∞–ª—ã (username, title, last_post_id, is_active) |
| `subscriptions` | –°–≤—è–∑—å user ‚Üî channel |
| `posts` | –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã (content, summary) |
| `userbot_sessions` | –°–µ—Å—Å–∏–∏ Pyrogram |

### –ú–∏–≥—Ä–∞—Ü–∏–∏

**–ù–ï–¢ –º–∏–≥—Ä–∞—Ü–∏–π!** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Base.metadata.create_all()` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É:
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ `models.py`
2. –í—Ä—É—á–Ω—É—é ALTER TABLE –≤ –ë–î –∏–ª–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É

---

## Userbot (MTProto)

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω

–í–µ–±-–ø–∞—Ä—Å–∏–Ω–≥ `t.me/s/channel` –¥–∞—ë—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç –∏ —Ñ–æ—Ç–æ. –î–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö, –∫—Ä—É–∂–∫–æ–≤, –≤–∏–¥–µ–æ –Ω—É–∂–µ–Ω MTProto.

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

1. –ü–æ–ª—É—á–∏—Ç—å API_ID –∏ API_HASH: https://my.telegram.org/apps
2. –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Railway
3. –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É –∏–ª–∏ curl:
```bash
curl -X POST $API/api/userbot/start -d '{"phone_number": "+79001234567"}'
curl -X POST $API/api/userbot/code -d '{"code": "12345"}'
```

### –†–∏—Å–∫–∏

- Telegram –º–æ–∂–µ—Ç –∑–∞–±–∞–Ω–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
- –ò—Å–ø–æ–ª—å–∑—É–π –û–¢–î–ï–õ–¨–ù–´–ô –∞–∫–∫–∞—É–Ω—Ç (–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π!)
- –í—Å—Ç—Ä–æ–µ–Ω–∞ –∑–∞—â–∏—Ç–∞: jitter ¬±30%, –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ–¥–∏–∞

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
–ü–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª–µ
    ‚Üì
Scheduler._check_channels()
    ‚Üì
userbot.get_channel_messages() ‚Üí —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Å media_type
    ‚Üì
_group_messages_by_album() ‚Üí –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ media_group_id
    ‚Üì
_process_message_group():
    ‚îú‚îÄ‚îÄ voice/video_note/audio/video ‚Üí transcriber.transcribe_bytes()
    ‚îú‚îÄ‚îÄ photo ‚Üí —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ userbot.download_media()
    ‚îî‚îÄ‚îÄ text ‚Üí –Ω–∞–ø—Ä—è–º—É—é
    ‚Üì
summarizer.summarize_multimodal(text, images, audio_transcript)
    ‚îú‚îÄ‚îÄ describe_images() ‚Üí –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ Gemma Vision
    ‚îî‚îÄ‚îÄ generate_content() ‚Üí –∏—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ
    ‚Üì
_send_summary() ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ aiogram
```

### –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ —Ç–∏–ø–æ–≤

–†–µ–∑—é–º–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Ä–∫–µ—Ä—ã: `[üìù —Ç–µ–∫—Å—Ç | üì∑ —Ñ–æ—Ç–æ (3) | üé¨ –≤–∏–¥–µ–æ]`

---

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ë–æ—Ç –Ω–µ –≤–∏–¥–∏—Ç –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã

1. –ü—Ä–æ–≤–µ—Ä—å `last_post_id` –≤ –ë–î ‚Äî –Ω–µ —Å–ª–∏—à–∫–æ–º –ª–∏ –±–æ–ª—å—à–æ–π?
2. –ü—Ä–æ–≤–µ—Ä—å –µ—Å—Ç—å –ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª
3. `/refresh` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### 502 –æ—à–∏–±–∫–∞ –Ω–∞ API

Scheduler –∑–∞–Ω—è—Ç –æ–±—Ä–∞–±–æ—Ç–∫–æ–π. –ü–æ–¥–æ–∂–¥–∏ –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å.

### Userbot –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

```bash
curl $API/api/userbot/status
```
–ï—Å–ª–∏ `state != authorized` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑—É–π –∑–∞–Ω–æ–≤–æ.

### Gemma –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç

–°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –Ω–∞ `Output: 0` –∏–ª–∏ `safety_ratings`. –ö–æ–Ω—Ç–µ–Ω—Ç –º–æ–≥ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω.

---

## TODO

- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –∞–¥–º–∏–Ω–∫–µ (–∑–∞—â–∏—Ç–∞ –ø–∞—Ä–æ–ª–µ–º)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ `google.genai` (deprecated warning)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—è–∑—ã–∫, —Ñ–æ—Ä–º–∞—Ç)
- [ ] –î–∞–π–¥–∂–µ—Å—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- [ ] –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–Ω–∞–ª—ã

---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –î–µ–ø–ª–æ–π –±—ç–∫–µ–Ω–¥–∞
railway up --detach

# –î–µ–ø–ª–æ–π –∞–¥–º–∏–Ω–∫–∏
cd admin && railway up --detach

# –õ–æ–≥–∏
railway logs

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
railway variables

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (—á–µ—Ä–µ–∑ Railway CLI)
railway run psql $DATABASE_URL
```
